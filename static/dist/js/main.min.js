function flushCaptch(e){var i=$(e),t=new Date-0,a=i.data("osrc");$(e).attr("src",a+"?t="+t)}function formatDate(e,i){var t=new Date(d),a={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};return/(y+)/.test(i)&&(i=i.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),new RegExp("("+k+")").test(i)&&(i=i.replace(RegExp.$1,1==RegExp.$1.length?a[k]:("00"+a[k]).substr((""+a[k]).length))),i}function elFinderBrowser(e,i,t,a){var n={file:"/datas/elfinder/elfinder.html",title:"elfinder文件管理器",onlyMimes:["image"],width:900,height:500,resizable:"yes"};return tinymce.activeEditor.windowManager.open(n,{setUrl:function(i){a.document.getElementById(e).value=i}}),!1}function initTinymce(e,i){tinymce.init({selector:e,theme:"modern",file_browser_callback:elFinderBrowser,convert_urls:!1,content_css:i||"",language:"zh_CN",plugins:["advlist autolink lists link image charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime media nonbreaking save table contextmenu directionality","emoticons template paste textcolor"],toolbar1:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",toolbar2:"print preview media | forecolor backcolor emoticons",image_advtab:!0,templates:[{title:"Test template 1",content:"Test 1"},{title:"Test template 2",content:"Test 2"}]})}function addUpload(e,i,t){var a,n,l,o,d,s,p,r,u,f,c,m,g,y,h,v,_,w,b;_="*.gif;*.jpg;*.png;*.jpeg",i=i?i:{},u=i.objtype?i.objtype:"default",f=i.params||!1,c=i.fieldid||"uplodify_ids",m=i.fieldpath||"uplodify_fpaths",g=i.fieldname||"uplodify_fnames",l="/static/dist/img/1opicity.png",y=i.json||!1,h=i.uploadurl||"",v=i.fileexts||_,w=function(e){var t,a,n="",l=e.fpath||"",o=e.fname||"";return e&&(t=o.lastIndexOf("."),t>=0&&(a=o.slice(t).toLowerCase(),n=-1==_.indexOf(a)?i.replacepic||"":l+"/"+o)),n},b=function(e){e.find(".uploadify_showpic").css("background-image","url()"),e.find(".uploadify_showname").html(""),e.find(".uplodify_ids").val(""),e.find(".uplodify_fpaths").val(""),e.find(".uplodify_fnames").val("")},"UPLOADIFY_CNT"in window||(window.UPLOADIFY_CNT={},$(".uploadify_add").live("click",function(){var e=$(this).parents(".uploadifyli").eq(0).data(),i=e.objtype,t=UPLOADIFY_CNT[i].cfg,a=UPLOADIFY_CNT[i].callback;addUpload(e.wraper,t,a)}),$(".uploadify_del").live("click",function(){var e=$(this).parents(".uploadifyli").eq(0),i=e.find(".uplodify_fpaths").val(),t=e.data();UPLOADIFY_CNT[t.objtype].upidx>1?(0===i.length||confirm("确认删除吗？没保存前删除的上传项不影响原有数据。"))&&($("#"+t.upid).uploadify("destroy"),UPLOADIFY_CNT[t.objtype].upidx--,e.remove()):b(e)})),u in UPLOADIFY_CNT||(UPLOADIFY_CNT[u]={upidx:0,isuploading:0,cfg:i,callback:t}),n=UPLOADIFY_CNT[u],o=++n.upidx,s="up_"+u+"_"+o,d=s+"_qid";var T=w(y),x=$('<div class="uploadifyli ccenter" data-upidx="'+o+'" data-queueid="'+d+'" data-upid='+s+' data-objtype="'+u+'" data-wraper="'+e+'" ><div class="">'+(i.hidedel?"":'<span class="uploadify_del">删除</span>')+(i.hidenew?"":'<span class="uploadify_add">新增</span>')+'</div><div class="uploadify_showpic" style="background-image:url('+T+');"></div>'+(i.showoname?'<div class="uploadify_showname breakword">'+(y?y.oname:"")+"</div>":"")+'<input type="hidden" class="uplodify_ids" name="'+c+'[]" value="'+(y?y.id:0)+'" ><input type="hidden" class="uplodify_fpaths" name="'+m+'[]" value="'+(y?y.fpath:"")+'"><input type="hidden" class="uplodify_fnames" name="'+g+'[]" value="'+(y?y.fname:"")+'"></div>').appendTo(e);a=$('<input class="uploadify_step" type="file" id="'+s+'" value="">').appendTo(x),r=f||{},r._fieldname="Filedata",r.objtype=u,p={auto:!0,removeCompleted:!0,removeTimeout:60,queueID:d,queueSizeLimit:1,fileTypeDesc:"文件",fileTypeExts:v,buttonText:"选择文件",swf:"/datas/uploadify/uploadify.swf",uploader:h,width:120,method:"post",debug:!1,multi:!0,formData:r,fileSizeLimit:"6MB",prevent_swf_caching:!0,button_image_url:i.buttonimg||l,overrideEvents:["onUploadProgress","onSelectError"],onUploadProgress:function(e,i,t){if(t>i){var a=i/t*100;a=a.toFixed(2),this.wrapper.uploadify("settings","buttonText",a+"%")}else this.wrapper.uploadify("settings","buttonText","loading...")},onUploadStart:function(){n.isuploading++},onUploadComplete:function(){n.isuploading--},onUploadSuccess:function(e,i){var a=$.parseJSON(i),n=a.data,l=this.wrapper.parent();if(a.code>0){var o=w(n);l.find(".uploadify_showpic").css("background-image","url("+o+")"),l.find(".uploadify_showname").html(n.oname),l.find(".uplodify_fpaths").val(n.fpath),l.find(".uplodify_fnames").val(n.fname)}this.wrapper.uploadify("settings","buttonText","选择文件"),delete this.queueData.files[e.id],t&&t(l,a)},onUploadError:function(e){alert('对不起，"'+e.name+'"上传失败，请重试')}},a.uploadify(p)}