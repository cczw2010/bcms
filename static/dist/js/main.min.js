function flushCaptch(e){var t=$(e),i=new Date-0,a=t.data("osrc");$(e).attr("src",a+"?t="+i)}function formatDate(e,t){var i=new Date(d),a={"M+":i.getMonth()+1,"d+":i.getDate(),"h+":i.getHours(),"m+":i.getMinutes(),"s+":i.getSeconds(),"q+":Math.floor((i.getMonth()+3)/3),S:i.getMilliseconds()};return/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(i.getFullYear()+"").substr(4-RegExp.$1.length))),new RegExp("("+k+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[k]:("00"+a[k]).substr((""+a[k]).length))),t}function elFinderBrowser(e,t,i,a){var n={file:__finderhtml,title:"elfinder文件管理器",onlyMimes:["image"],width:900,height:500,resizable:"yes"};return tinymce.activeEditor.windowManager.open(n,{setUrl:function(t){a.document.getElementById(e).value=t}}),!1}function initTinymce(e,t,i){i&&(__finderhtml="/datas/elfinder/melfinder.html"),tinymce.init({selector:e,theme:"modern",file_browser_callback:elFinderBrowser,convert_urls:!1,content_css:t||"",language:"zh_CN",plugins:["advlist autolink lists link image charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime media nonbreaking save table contextmenu directionality","emoticons template paste textcolor"],toolbar1:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",toolbar2:"print preview media | forecolor backcolor emoticons",image_advtab:!0,templates:[{title:"Test template 1",content:"Test 1"},{title:"Test template 2",content:"Test 2"}]})}function addUpload(e,t,i){var a,n,l,o,d,s,p,r,u,f,c,m,g,h,y,_,v,b,w;v="*.gif;*.jpg;*.png;*.jpeg",t=t?t:{},u=t.objtype?t.objtype:"default",f=t.params||!1,c=t.fieldid||"uplodify_ids",m=t.fieldpath||"uplodify_fpaths",g=t.fieldname||"uplodify_fnames",l="/static/dist/img/1opicity.png",t.json&&(h=t.json,t.json=null),y=t.uploadurl||"",_=t.fileexts||v,b=function(e){var i,a,n="",l="",o="";return e&&(l=e.fpath,o=e.fname,i=o.lastIndexOf("."),i>=0&&(a=o.slice(i).toLowerCase(),n=-1==v.indexOf(a)?t.replacepic||"":l+"/"+o)),n},w=function(e){e.find(".uploadify_showpic").css("background-image","url()"),e.find(".uploadify_showname").html(""),e.find(".uplodify_ids").val(""),e.find(".uplodify_fpaths").val(""),e.find(".uplodify_fnames").val("")},"UPLOADIFY_CNT"in window||(window.UPLOADIFY_CNT={},$("body").on("click",".uploadify_add",function(){var e=$(this).parents(".uploadifyli").eq(0).data(),t=e.objtype,i=UPLOADIFY_CNT[t].cfg,a=UPLOADIFY_CNT[t].callback;addUpload(e.wraper,i,a)}),$("body").on("click",".uploadify_del",function(){var e=$(this).parents(".uploadifyli").eq(0),t=e.find(".uplodify_fpaths").val(),i=e.data();UPLOADIFY_CNT[i.objtype].upidx>1?(0===t.length||confirm("确认删除吗？没保存前删除的上传项不影响原有数据。"))&&($("#"+i.upid).uploadify("destroy"),UPLOADIFY_CNT[i.objtype].upidx--,e.remove()):w(e)})),u in UPLOADIFY_CNT||(UPLOADIFY_CNT[u]={upidx:0,isuploading:0,cfg:t,callback:i}),n=UPLOADIFY_CNT[u],o=++n.upidx,s="up_"+u+"_"+o,d=s+"_qid";var T=b(h),k=$('<div class="uploadifyli ccenter" data-upidx="'+o+'" data-queueid="'+d+'" data-upid='+s+' data-objtype="'+u+'" data-wraper="'+e+'" ><div class="">'+(t.hidedel?"":'<span class="uploadify_del">删除</span>')+(t.hidenew?"":'<span class="uploadify_add">新增</span>')+'</div><div class="uploadify_showpic" style="height: 100px;background-size: contain;background-repeat: no-repeat;background-image:url('+T+');"></div>'+(t.showoname?'<div class="uploadify_showname breakword">'+(h?h.oname:"")+"</div>":"")+'<input type="hidden" class="uplodify_ids" name="'+c+'[]" value="'+(h?h.id:0)+'" ><input type="hidden" class="uplodify_fpaths" name="'+m+'[]" value="'+(h?h.fpath:"")+'"><input type="hidden" class="uplodify_fnames" name="'+g+'[]" value="'+(h?h.fname:"")+'"></div>').appendTo(e);a=$('<input class="uploadify_step" type="file" id="'+s+'" value="">').appendTo(k),r=f||{},r._fieldname="Filedata",r.objtype=u,p={auto:!0,removeCompleted:!0,removeTimeout:60,queueID:d,queueSizeLimit:1,fileTypeDesc:"文件",fileTypeExts:_,buttonText:"选择文件",swf:"/datas/uploadify/uploadify.swf",uploader:y,width:120,method:"post",debug:!1,multi:!0,formData:r,fileSizeLimit:"6MB",prevent_swf_caching:!0,button_image_url:t.buttonimg||l,overrideEvents:["onUploadProgress","onSelectError"],onUploadProgress:function(e,t,i){if(i>t){var a=t/i*100;a=a.toFixed(2),this.wrapper.uploadify("settings","buttonText",a+"%")}else this.wrapper.uploadify("settings","buttonText","loading...")},onUploadStart:function(){n.isuploading++},onUploadComplete:function(){n.isuploading--},onUploadSuccess:function(e,t){var t=$.parseJSON(t),a=t.data,n=this.wrapper.parent();if(t.code>0){var l=b(a);n.find(".uploadify_showpic").css("background-image","url("+l+")"),n.find(".uploadify_showname").html(a.oname),n.find(".uplodify_fpaths").val(a.fpath),n.find(".uplodify_fnames").val(a.fname)}this.wrapper.uploadify("settings","buttonText","选择文件"),this.queueData.files[e.id]=null,i&&i(n,t)},onUploadError:function(e){alert('对不起，"'+e.name+'"上传失败，请重试')}},a.uploadify(p)}var __finderhtml="/datas/elfinder/elfinder.html";