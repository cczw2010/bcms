function flushCaptch(e){var t=$(e),i=new Date-0,a=t.data("osrc");$(e).attr("src",a+"?t="+i)}function formatDate(e,t){var i=new Date(d),a={"M+":i.getMonth()+1,"d+":i.getDate(),"h+":i.getHours(),"m+":i.getMinutes(),"s+":i.getSeconds(),"q+":Math.floor((i.getMonth()+3)/3),S:i.getMilliseconds()};return/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(i.getFullYear()+"").substr(4-RegExp.$1.length))),new RegExp("("+k+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[k]:("00"+a[k]).substr((""+a[k]).length))),t}function elFinderBrowser(e,t,i,a){var l={file:__finderhtml,title:"elfinder文件管理器",onlyMimes:["image"],width:900,height:500,resizable:"yes"};return tinymce.activeEditor.windowManager.open(l,{setUrl:function(t){a.document.getElementById(e).value=t}}),!1}function initTinymce(e,t,i){i&&(__finderhtml="/datas/elfinder/melfinder.html"),tinymce.init({selector:e,theme:"modern",file_browser_callback:elFinderBrowser,convert_urls:!1,content_css:t||"",language:"zh_CN",plugins:["advlist autolink lists link image charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime media nonbreaking save table contextmenu directionality","emoticons template paste textcolor"],toolbar1:"insertfile undo redo | styleselect | fontname fontsize |bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",toolbar2:"print preview media | fontsizeselect forecolor backcolor emoticons",fontsize_formats:"8px 10px 12px 14px 18px 24px 36px",image_advtab:!0,templates:[{title:"Test template 1",content:"Test 1"},{title:"Test template 2",content:"Test 2"}]})}var __finderhtml="/datas/elfinder/elfinder.html";(function(e){function t(e,t){this.wraper=$("#"+e.queueID),t=t||{},callback=t.callback||!1,this.hasDesc=t.hasDesc||!1,this.canSort=t.canSort||!1,this.hasLink=t.hasLink||!1;var i={auto:!0,buttonText:"选择图片",dnd:!1,fileObjName:"file",fileSizeLimit:10485760,fileType:"image/*",height:40,width:100,itemTemplate:this.getTemplateHtml(),method:"post",multi:!0,queueSizeLimit:12,removeCompleted:!1,simUploadLimit:2,uploadLimit:20,queueID:"",uploadScript:"",overrideEvents:["onError"],onProgress:function(e,t){if(t.lengthComputable){var i=Math.round(t.loaded/t.total*100);e.queueItem.find(".fileinfo").html(i+"%"),e.queueItem.find(".progress-bar").css("width",i+"%")}else e.queueItem.find(".fileinfo").html("uploading")},onUploadComplete:function(e,t){if(console.log("onUploadComplete",t),t=JSON.parse(t),t.code<=0)return e.queueItem.addClass("error").find(".fileinfo").html(t.msg),callback(a(t.msg),e),!1;t=t.data,e.queueItem.find(".filecover").css("background-image","url("+t.fpath+"/"+t.fname+")"),e.queueItem.find(".uplodify_ids").val("0"),e.queueItem.find(".uplodify_fpaths").val(t.fpath),e.queueItem.find(".uplodify_fnames").val(t.fname),callback(null,e,t)},onCancel:function(e){uploadifive=$(this).data("uploadifive"),uploadifive.settings.uploadLimit++,console.log("onCancel",e)},onFallback:function(){console.log("该浏览器无法使用!")},onUpload:function(e){console.log("onUpload",e)},onUploadFile:function(e){console.log("The file "+e.name+" is being uploaded.")},onError:function(e,t){console.log("The error was: "+e),callback(a(e),t)},onDestroy:function(){console.log("Oh noes!  you destroyed UploadiFive!")}};this.setting=$.extend(i,e),this.uploadDom=t.btnWraper?$(t.btnWraper):$('<input type="file" name="uplodifive_file_upload" id="uplodifive_file_upload"  style=""/>').appendTo(this.wraper),this.uploadDom.uploadifive(this.setting),this.canSort&&this.wraper.on("click",".uploadifive-sort span",function(){var e=$(this).parents(".uploadifive-queue-item"),t=(e.parent(),e.index());if("left"==this.dataset.dir)t>0&&e.insertBefore(e.prev(".uploadifive-queue-item"));else{var i=e.next(".uploadifive-queue-item");1==i.length&&e.insertAfter(i)}console.log(this.dataset.dir,e)})}var i={UPLOAD_LIMIT_EXCEEDED:"到达文件上传上限",QUEUE_LIMIT_EXCEEDED:"当前队列已经达到到上限，请删除不必要的图片再试","404_FILE_NOT_FOUND":"文件不存在","403_FORBIDDEN":"文件禁止访问",FORBIDDEN_FILE_TYPE:"非允许的文件类型",FILE_SIZE_LIMIT_EXCEEDED:"文件超过上线",defualt:"未知错误"},a=function(e){return e&&e in i?i[e]:i.defualt},l="uplodify_ids[]",n="uplodify_fpaths[]",o="uplodify_fnames[]",s="uplodify_links[]",r="uplodify_descs[]";t.prototype.getTemplateHtml=function(e){return'<div class="uploadifive-queue-item '+(e?"complete preparepic":"")+'"><input type="hidden" class="uplodify_ids" name="'+l+'" value="'+(e?e.id:"")+'" ><input type="hidden" class="uplodify_fpaths" name="'+n+'" value="'+(e?e.fpath:"")+'" ><input type="hidden" class="uplodify_fnames" name="'+o+'" value="'+(e?e.fname:"")+'" ><div class="filecover" style="background-image:url('+(e?e.fpath+"/"+e.fname:"")+')"></div>'+(e?"":'<div class="progress"><div class="progress-bar"></div></div>')+'<div class="filename">'+(e?e.fname:"")+'</div><div class="fileinfo">'+(e?"已有图片":"")+"</div><textarea "+(this.hasDesc?"":'style="display:none"')+' class="uplodify_descs" rows="2" name="'+r+'" placeholder="请输入描述">'+(e&&e.desc?e.desc:"")+"</textarea><input "+(this.hasLink?"":'type="hidden"')+' class="uplodify_links" name="'+s+'" placeholder="请输入链接地址" value="'+(e&&e.links?e.links:"")+'">'+(this.canSort?'<div class="uploadifive-sort"><span class="uploadifive-sort-left" data-dir="left">←</span><span class="uploadifive-sort-right" data-dir="right">→</span></div>':"")+'<div class="close '+(e?"uploadifive_prepare_close":"")+'"></div>'},t.prototype.getUploadifive=function(){return $(this.uploadDom).data("uploadifive")},t.prototype.prepare=function(e){var t=function(e){confirm("确认删除原有图片吗？")&&($(e.target).parent().remove(),this.getUploadifive().queue.count--,this.getUploadifive().queue.queued--)}.bind(this);for(var i in e){this.getUploadifive().queue.count++,this.getUploadifive().queue.queued++;var a=$(this.getTemplateHtml(e[i]));a.find(".uploadifive_prepare_close").on("click",t),this.wraper.append(a)}},e.SUplodiFive=t})(this);