<?php
//----------------------------------------------
/*
 redis 缓存类配置如下：  by awen
 *	$config =>array(
 * 			'ttl'=>1000 ;
 * 			'servers'=>array ( 
 *    						array ( 
 *						        'host'      =>  '127.0.0.1' , 
 *       						'port'      =>  6379 , 
 *       						'database'  =>  15 ,  
 *      						'alias'     =>  'first' ,   //主
 *    						) , 
 *    						array ( 
 *   			   				'host'      =>  '127.0.0.1' , 
 *       						'port'      =>  6380 , 
 *       						'database'  =>  15 , 
 *       						'alias'     =>  'second' , //从
 *    						) , 
*			), 
 *  );
 */
class Cache_redis implements Cache{
	public static $redis;
	private $ttl=0;
	function __construct($config=array()){
		//如果由配置信息，则根据配置信息初始化，否则加载默认配置
		if (!isset(self::$redis)) {
			self::$redis = new Predis\Client($config);
		}
		if (isset($config['ttl'])) {
			$this->ttl=$config['ttl'];
		}
	}
    public function get($key){
        if (isset(self::$redis)) {
        	return self::$redis->get($key);
        }else{
        	return FALSE;
        }
    }
    public function set($key,$val,$ttl=-1){
 		if (isset(self::$redis)) {
 			if ($ttl<0) {
 				$ttl=$this->ttl;
			}
        	return self::$redis->setex($key, $ttl,$val);
        }else{
        	return FALSE;
        }
    }
    public function delete($key){
 		if (isset(self::$redis)) {
        	return self::$redis->del($key);
        }else{
        	return FALSE;
        }
    }
    //清空当前库
    public function clear(){
    	if (isset(self::$redis)) {
        	return self::$redis->flushdb();
        }else{
        	return FALSE;
        }
    }
}